<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"misakatang.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"style":null,"show_result":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="The limits of my language are the limits of my world">
<meta property="og:type" content="website">
<meta property="og:title" content="MisakaTang&#39;s Blog">
<meta property="og:url" content="http://misakatang.cn/page/4/index.html">
<meta property="og:site_name" content="MisakaTang&#39;s Blog">
<meta property="og:description" content="The limits of my language are the limits of my world">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="MisakaTang">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://misakatang.cn/page/4/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/4/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>MisakaTang's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4TSLH4NC9H"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-4TSLH4NC9H","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?de7c77febeeac252eee468207ae11ce4"></script>



  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "jtb4czrfeu");
</script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="MisakaTang's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">MisakaTang's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="MisakaTang"
      src="/images/misaka.jpg">
  <p class="site-author-name" itemprop="name">MisakaTang</p>
  <div class="site-description" itemprop="description">The limits of my language are the limits of my world</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/%E5%BD%92%E6%A1%A3/">
          <span class="site-state-item-count">101</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">100</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/TangMisaka23001" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;TangMisaka23001" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:mikasatang@gmail.com" title="E-Mail → mailto:mikasatang@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="http://blog.bbchen.top/" title="http:&#x2F;&#x2F;blog.bbchen.top" rel="noopener" target="_blank">BB chen的漂流记</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://blog.zhuzhenyuan.cn/" title="http:&#x2F;&#x2F;blog.zhuzhenyuan.cn" rel="noopener" target="_blank">Aurthur_的博客</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://misakatang.cn/2023/11/15/programming-language-pragmatics-01/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/misaka.jpg">
      <meta itemprop="name" content="MisakaTang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MisakaTang's Blog">
      <meta itemprop="description" content="The limits of my language are the limits of my world">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | MisakaTang's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/15/programming-language-pragmatics-01/" class="post-title-link" itemprop="url">《Programming Language Pragmatics》摘录翻译-其一</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-11-15 11:45:14" itemprop="dateCreated datePublished" datetime="2023-11-15T11:45:14+00:00">2023-11-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-14 08:33:24" itemprop="dateModified" datetime="2024-03-14T08:33:24+00:00">2024-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/%E5%88%86%E7%B1%BB/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="The-Art-of-Language-Design"><a href="#The-Art-of-Language-Design" class="headerlink" title="The Art of Language Design"></a>The Art of Language Design</h2><p>Today there are thousands of high-level programming languages, and new ones continue to emerge. Human beings use assembly language only for specialpurpose applications. In a typical undergraduate class, it is not uncommon to find users of scores of different languages. Why are there so many? There are several possible answers:</p>
<blockquote>
<p>今天有成千上万种高级编程语言，而且新的语言不断涌现。人类只在特定应用中使用汇编语言。在典型的本科课程中，发现使用数十种不同语言的情况并不罕见。为什么会有这么多种语言？这有几个可能的答案：</p>
</blockquote>
<h3 id="Evolution"><a href="#Evolution" class="headerlink" title="Evolution."></a>Evolution.</h3><p>Computer science is a young discipline; we’re constantly finding better ways to do things. The late 1960s and early 1970s saw a revolution in “structured programming,” in which the goto-based control flow of languages like Fortran,Cobol,and Basic3 gave way to while loops, case (switch) statements, and similar higher level constructs. In the late 1980s the nested block structure of languages like Algol,Pascal,and Ada began to give way to the object-oriented structure of Smalltalk, C++, Eiffel, and the like.</p>
<blockquote>
<p>计算机科学是一个年轻的学科；我们不断发现更好的做事方式。20世纪60年代末和70年代初，出现了“结构化编程”的革命，其中像Fortran、Cobol和Basic3这样基于goto的控制流让位给了while循环、case（switch）语句和类似的更高级构造。到了20世纪80年代末，像Algol、Pascal和Ada这样的语言的嵌套块结构开始让位于Smalltalk、C++、Eiffel等面向对象的结构。</p>
</blockquote>
<h3 id="Special-Purposes"><a href="#Special-Purposes" class="headerlink" title="Special Purposes."></a>Special Purposes.</h3><p>Many languages were designed for a specific problem domain. The various Lisp dialects are good for manipulating symbolic data and complex data structures. Icon and Awk are good for manipulating character strings. C is good for low-level systems programming. Prolog is good for reasoning about logical relationships among data. Each of these languages can be used successfully for a wider range of tasks, but the emphasis is clearly on the specialty.</p>
<blockquote>
<p>许多编程语言是为特定的问题领域而设计的。各种Lisp方言适用于操纵符号数据和复杂数据结构。Icon和Awk适用于操纵字符串。C适用于低级系统编程。Prolog适用于推理数据之间的逻辑关系。这些语言都可以成功地用于更广泛的任务，但重点显然在于专业领域。</p>
</blockquote>
<h3 id="Personal-Preference"><a href="#Personal-Preference" class="headerlink" title="Personal Preference."></a>Personal Preference.</h3><p>Different people like different things. Much of the parochialism of programming is simply a matter of taste. Some people love the terseness of C; some hate it. Some people find it natural to think recursively; others prefer iteration. Some people like to work with pointers; others prefer the implicit dereferencing of Lisp, Clu, Java, and ML. The strength and variety of personal preference make it unlikely that anyone will ever develop a universally acceptable programming language.</p>
<blockquote>
<p>不同的人喜欢不同的东西。编程中的很多偏见只是品味上的问题。有些人喜欢C的简洁性；有些人则讨厌。有些人觉得递归思考很自然；而其他人则更喜欢迭代。有些人喜欢使用指针；其他人则更喜欢Lisp、Clu、Java和ML中隐式解引用的方式。个人偏好的强大和多样性使得几乎不可能有人能够开发出一个被普遍接受的编程语言。</p>
</blockquote>
<p>Of course, some languages are more successful than others. Of the many that have been designed, only a few dozen are widely used. What makes a language successful? Again there are several answers:</p>
<blockquote>
<p>当然，一些语言比其他语言更成功。在众多被设计出来的语言中，只有几十种被广泛使用。是什么让一种语言成功？这个问题有几个答案：</p>
</blockquote>
<h3 id="Expressive-Power"><a href="#Expressive-Power" class="headerlink" title="Expressive Power."></a>Expressive Power.</h3><p>One commonly hears arguments that one language is more “powerful” than another, though in a formal mathematical sense they are all Turing complete—each can be used, if awkwardly, to implement arbitrary algorithms. Still, language features clearly have a huge impact on the programmer’s ability to write clear, concise, and maintainable code, especially for very large systems. There is no comparison, for example, between early versions of Basic on the one hand, and Common Lisp or Ada on the other. The factors that contribute to expressive power—abstraction facilities in particular—are a major focus of this book.</p>
<blockquote>
<p>人们经常听到有关一种语言比另一种语言更“强大”的论点，尽管从正式的数学意义上讲，它们都是图灵完备的——每种语言都可以被使用（虽然有时会很笨拙）来实现任意算法。然而，语言特性显然对程序员编写清晰、简洁和易维护的代码能力产生巨大影响，特别是对于非常庞大的系统。例如，早期的Basic与Common Lisp或Ada之间是无法比较的。构成表达能力的因素——尤其是抽象设施——是本书的主要关注点。</p>
</blockquote>
<h3 id="Ease-of-Use-for-the-Novice"><a href="#Ease-of-Use-for-the-Novice" class="headerlink" title="Ease of Use for the Novice."></a>Ease of Use for the Novice.</h3><p>While it is easy to pick on Basic, one cannot deny its success. Part of that success is due to its very low “learning curve.” Logo is popular among elementary-level educators for a similar reason: even a 5-year-old can learn it. Pascal was taught for many years in introductory programming language courses because, at least in comparison to other “serious” languages, it is compact and easy to learn. In recent years Java has come to play a similar role. Though substantially more complex than Pascal, it is much simpler than, say, C++.</p>
<blockquote>
<p>虽然批评Basic很容易，但人们无法否认它的成功。它的成功部分归功于其非常低的“学习曲线”。类似的原因，Logo在小学教育者中很受欢迎：甚至5岁的孩子都可以学会。Pascal在很多年里被用来教授入门级编程语言课程，因为至少与其他“严肃”的语言相比，它更为简洁且易学。近年来，Java也开始扮演类似的角色。虽然比Pascal复杂得多，但它比如C++等语言简单得多。</p>
</blockquote>
<h3 id="Ease-of-Implementation"><a href="#Ease-of-Implementation" class="headerlink" title="Ease of Implementation."></a>Ease of Implementation.</h3><p>In addition to its low learning curve, Basic is successful because it could be implemented easily on tiny machines, with limited resources. Forth has a small but dedicated following for similar reasons. Arguably the single most important factor in the success of Pascal was that its designer, Niklaus Wirth, developed a simple, portable implementation of the language, and shipped it free to universities all over the world (see Example 1.15).4 The Java designers took similar steps to make their language available for free to almost anyone who wants it.</p>
<blockquote>
<p>除了其低学习曲线之外，Basic之所以成功，还因为它可以轻松在资源有限的小型设备上实现。Forth也因类似的原因拥有一小部分忠实的追随者。可以说，Pascal成功的最重要因素之一是其设计者尼古拉斯·沃斯（Niklaus Wirth）开发了一种简单、可移植的语言实现，并免费提供给全球各地的大学（见示例1.15）。Java的设计者们也采取了类似的措施，让他们的语言几乎可以免费提供给任何想要使用它的人。</p>
</blockquote>
<h3 id="Standardization"><a href="#Standardization" class="headerlink" title="Standardization."></a>Standardization.</h3><p>Almost every widely used language has an official international standard or (in the case of several scripting languages) a single canonical implementation; and in the latter case the canonical implementation is almost invariably written in a language that has a standard. Standardization—of both the language and a broad set of libraries—is the only truly effective way to ensure the portability of code across platforms. The relatively impoverished standard for Pascal, which is missing several features considered essential by many programmers (separate compilation, strings, static initialization, random-access I&#x2F;O), is at least partially responsible for the language’s drop from favor in the 1980s. Many of these features were implemented in different ways by different vendors.</p>
<blockquote>
<p>几乎每种广泛使用的编程语言都有一个官方的国际标准，或者（在一些脚本语言的情况下）有一个单一的规范实现；而在后一种情况下，规范实现几乎总是用一种有标准的语言编写。标准化——无论是语言本身还是一套广泛的库——是确保代码在各种平台上可移植的唯一真正有效的方法。Pascal的标准相对较为简陋，缺少许多被许多程序员认为是必不可少的功能（如独立编译、字符串、静态初始化、随机访问I&#x2F;O），这在一定程度上导致了该语言在20世纪80年代失宠。许多这些功能是由不同的供应商以不同的方式实现的。</p>
</blockquote>
<h3 id="Open-Source"><a href="#Open-Source" class="headerlink" title="Open Source."></a>Open Source.</h3><p>Most programming languages today have at least one open-source compiler or interpreter, but some languages—C in particular—are much more closely associated than others with freely distributed, peer-reviewed, community-supported computing. C was originally developed in the early 1970s by Dennis Ritchie and Ken Thompson at Bell Labs,5 in conjunction with the design of the original Unix operating system. Over the years Unix evolved into the world’s most portable operating system—the OS of choice for academic computer science—and C was closely associated with it. With the standardization of C, the language has become available on an enormous variety of additional platforms. Linux, the leading open-source operating system, is written in C. As of October 2008, C and its descendants account for 66% of the projects hosted at the sourceforge.net repository.</p>
<blockquote>
<p>如今，大多数编程语言至少都有一个开源编译器或解释器，但有些语言——尤其是C语言——与自由分发、同行评审、社区支持的计算密切相关。C语言最初是在20世纪70年代初由贝尔实验室的丹尼斯·里奇（Dennis Ritchie）和肯·汤普逊（Ken Thompson）开发的，同时也是与最初的Unix操作系统的设计相关联的。多年来，Unix发展成为世界上最具可移植性的操作系统——成为学术计算机科学的首选操作系统，并与C语言密切相关。随着C语言的标准化，该语言已经可以在大量额外的平台上使用。领先的开源操作系统Linux就是用C语言编写的。截至2008年10月，在sourceforge.net代码库托管的项目中，C语言及其衍生版本占了66%。</p>
</blockquote>
<h3 id="Excellent-Compilers"><a href="#Excellent-Compilers" class="headerlink" title="Excellent Compilers."></a>Excellent Compilers.</h3><p>Fortran owes much of its success to extremely good compilers. In part this is a matter of historical accident. Fortran has been around longer than anything else, and companies have invested huge amounts of time and money in making compilers that generate very fast code. It is also a matter of language design, however: Fortran dialects prior to Fortran 90 lack recursion and pointers, features that greatly complicate the task of generating fast code (at least for programs that can be written in a reasonable fashion without them!). In a similar vein, some languages (e.g., Common Lisp) are successful in part because they have compilers and supporting tools that do an unusually good job of helping the programmer manage very large projects.</p>
<blockquote>
<p>Fortran的成功很大程度上归功于非常优秀的编译器。部分原因是历史的偶然性。Fortran的历史比其他任何语言都要悠久，许多公司投入了大量时间和资金来开发能够生成非常高效代码的编译器。然而，这也与语言设计有关：Fortran 90之前的方言缺乏递归和指针，这些特性会极大地复杂化生成高效代码的任务（至少对于可以在不使用它们的情况下以合理方式编写的程序来说是如此！）。类似地，一些语言（例如Common Lisp）之所以成功，部分原因在于它们具有编译器和支持工具，这些工具在帮助程序员管理非常大型项目方面做得异常出色。</p>
</blockquote>
<h3 id="Economics-Patronage-and-Inertia"><a href="#Economics-Patronage-and-Inertia" class="headerlink" title="Economics, Patronage, and Inertia."></a>Economics, Patronage, and Inertia.</h3><p>Finally, there are factors other than technical merit that greatly influence success. The backing of a powerful sponsor is one. PL&#x2F;I, at least to first approximation, owes its life to IBM. Cobol and, more recently, Ada owe their life to the U.S. Department of Defense: Ada contains a wealth of excellent features and ideas, but the sheer complexity of implementation would likely have killed it if not for the DoD backing. Similarly, C#, despite its technical merits, would probably not have received the attention it has without the backing of Microsoft. At the other end of the life cycle, some languages remain widely used long after “better” alternatives are available because of a huge base of installed software and programmer expertise, which would cost too much to replace.</p>
<blockquote>
<p>最后，除了技术优势之外，还有其他因素极大地影响着成功。强大赞助商的支持是其中之一。例如，PL&#x2F;I至少在最初阶段，归功于IBM。Cobol和最近的Ada都归功于美国国防部：Ada包含了大量出色的特性和想法，但如果没有美国国防部的支持，其实现的复杂性很可能会使其难以生存。同样，尽管C#在技术上有其优点，但如果没有微软的支持，它可能不会得到如今的关注。另一方面，一些语言在更好的替代方案出现后仍然被广泛使用，这是因为已安装的软件和程序员的专业知识庞大，替换它们的成本太高。</p>
</blockquote>
<p>Clearly no single factor determines whether a language is “good.” As we study programming languages, we shall need to consider issues from several points of view. In particular, we shall need to consider the viewpoints of both the programmer and the language implementor. Sometimes these points of view will be in harmony, as in the desire for execution speed. Often, however, there will be conflicts and tradeoffs, as the conceptual appeal of a feature is balanced against the cost of its implementation. The tradeoff becomes particularly thorny when the implementation imposes costs not only on programs that use the feature, but also on programs that do not.</p>
<blockquote>
<p>显然，没有单一因素能决定一种语言是否“优秀”。在研究编程语言时，我们需要从多个角度考虑问题。特别是，我们需要考虑程序员和语言实现者的观点。有时这些观点会保持一致，比如对执行速度的渴望。然而，通常会存在冲突和权衡，比如某项特性的概念吸引力与其实现成本之间的平衡。当实现不仅给使用该特性的程序带来成本，而且也给不使用该特性的程序带来成本时，这种权衡变得特别棘手。</p>
</blockquote>
<p>In the early days of computing the implementor’s viewpoint was predominant. Programming languages evolved as a means of telling a computer what to do. For programmers, however, a language is more aptly defined as a means of expressing algorithms. Just as natural languages constrain exposition and discourse, so programming languages constrain what can and cannot easily be expressed, and have both profound and subtle influence over what the programmer can think. Donald Knuth has suggested that programming be regarded as the art of telling another human being what one wants the computer to do [Knu84].6 This definition perhaps strikes the best sort of compromise. It acknowledges that both conceptual clarity and implementation efficiency are fundamental concerns. This book attempts to capture this spirit of compromise,by simultaneously considering the conceptual and implementation aspects of each of the topics it covers.</p>
<blockquote>
<p>在计算机的早期发展阶段，实现者的观点占据主导地位。编程语言演变为告诉计算机该做什么的手段。然而，对于程序员来说，语言更恰当地被定义为表达算法的手段。就像自然语言限制了表述和交流一样，编程语言也限制了什么可以和不能轻松地表达，并对程序员的思维产生深远而微妙的影响。Donald Knuth曾建议将编程视为告诉另一个人想让计算机做什么的艺术。这个定义或许达到了最好的折衷。它承认了概念上的清晰和实现效率都是基本关注点。本书试图捕捉这种折衷的精神，同时考虑所涵盖主题的概念和实现方面。</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://misakatang.cn/2023/11/10/a-philosophy-of-software-design/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/misaka.jpg">
      <meta itemprop="name" content="MisakaTang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MisakaTang's Blog">
      <meta itemprop="description" content="The limits of my language are the limits of my world">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | MisakaTang's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/11/10/a-philosophy-of-software-design/" class="post-title-link" itemprop="url">《A Philosophy of Software Design》笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-11-10 11:45:14" itemprop="dateCreated datePublished" datetime="2023-11-10T11:45:14+00:00">2023-11-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-14 08:33:24" itemprop="dateModified" datetime="2024-03-14T08:33:24+00:00">2024-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/%E5%88%86%E7%B1%BB/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>作者的主要观念是关于系统解耦和信息隐藏，接口抽象就是隐藏不必要的细节防止对外暴露系统内的信息。作者提倡一个系统内的逻辑应该是“深”的而不是“宽”的（非常多的对外接口），这样会对外暴露更多的信息。</p>
<p>其余的内容大多是老生常谈的问题，例如如何写好注释。</p>
<p>这本书的另一个优点是行文简单，纯英文阅读很流畅，值得一读。</p>
<blockquote>
<p>The most fundamental problem in computer science is problem decomposition: how to take a complex problem and divide it up into pieces that can be solved independently.</p>
</blockquote>
<blockquote>
<p>Writing computer software is one of the purest creative activities in the history of the human race. Programmers aren’t bound by practical limitations such as the laws of physics; we can create exciting virtual worlds with behaviors that could never exist in the real world. </p>
</blockquote>
<blockquote>
<p>There are two general approaches to fighting complexity, both of which will be discussed in this book.</p>
</blockquote>
<blockquote>
<p>The first approach is to eliminate complexity by making code simpler and more obvious.</p>
</blockquote>
<blockquote>
<p>The second approach to complexity is to encapsulate it, so that programmers can work on a system without being exposed to all of its complexity at once.</p>
</blockquote>
<h2 id="复杂性的本质"><a href="#复杂性的本质" class="headerlink" title="复杂性的本质"></a>复杂性的本质</h2><h3 id="复杂性定义"><a href="#复杂性定义" class="headerlink" title="复杂性定义"></a>复杂性定义</h3><blockquote>
<p>Complexity is anything related to the structure of a software system that makes it hard to understand and modify the system.</p>
</blockquote>
<h3 id="复杂性的症状"><a href="#复杂性的症状" class="headerlink" title="复杂性的症状"></a>复杂性的症状</h3><ul>
<li>Change amplification（变更放大）</li>
<li>Cognitive load（认知负担）：开发者需要知道多少相关内容才能完成任务。代码长短并不能代表复杂度，更简单的实现方式可以降低认知负担（代码可能更长）</li>
<li>Unknown unknowns（不知道还有什么是不知道的）：三个之中这个是最差的症状</li>
</ul>
<blockquote>
<p>One of the most important goals of good design is for a system to be obvious.</p>
</blockquote>
<p>好的系统应该是显而易见的。</p>
<h3 id="造成复杂性的原因"><a href="#造成复杂性的原因" class="headerlink" title="造成复杂性的原因"></a>造成复杂性的原因</h3><blockquote>
<p>Complexity is caused by two things: dependencies and obscurity.</p>
</blockquote>
<h3 id="复杂度是逐渐递增的"><a href="#复杂度是逐渐递增的" class="headerlink" title="复杂度是逐渐递增的"></a>复杂度是逐渐递增的</h3><p>复杂性不是由一个灾难性的错误导致的，而是大量的小块组成。复杂性的渐进性使其难以控制。</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>复杂性来自依赖和模糊的积累。随着复杂性的增加，会导致变化放大、认知负荷增加以及未知的未知因素。因此，实现每个新功能需要更多的代码修改。此外，开发人员花费更多时间获取足够的信息以确保安全修改，甚至在最糟糕的情况下，他们甚至无法找到所需的所有信息。总之，复杂性使得修改现有代码基础变得困难且风险高。</p>
<h2 id="能跑的代码是不够的（战略和战术编程）"><a href="#能跑的代码是不够的（战略和战术编程）" class="headerlink" title="能跑的代码是不够的（战略和战术编程）"></a>能跑的代码是不够的（战略和战术编程）</h2><h3 id="战术编程"><a href="#战术编程" class="headerlink" title="战术编程"></a>战术编程</h3><p>在实现新功能或修复bug时只关注让代码跑起来就行。 这是造成系统复杂度的根源。</p>
<h3 id="战略编程"><a href="#战略编程" class="headerlink" title="战略编程"></a>战略编程</h3><p>首先需要意识到能work的代码是不够的。为了快速完成当前的任务引入不必要的复杂性是不可接受的。</p>
<h3 id="代价"><a href="#代价" class="headerlink" title="代价"></a>代价</h3><p>每次付出开发时间的10%-20%来进行战略编程是合理的。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>天下没有免费的午餐。小错误累计会引发大错误。幸运的是，好的设计最终会证明他自己是值得的。</p>
<h2 id="好的模块应该是“深”的"><a href="#好的模块应该是“深”的" class="headerlink" title="好的模块应该是“深”的"></a>好的模块应该是“深”的</h2><h3 id="抽象"><a href="#抽象" class="headerlink" title="抽象"></a>抽象</h3><blockquote>
<p>An abstraction is a simplified view of an entity, which omits unimportant details. </p>
</blockquote>
<h3 id="Deep-modules"><a href="#Deep-modules" class="headerlink" title="Deep modules"></a>Deep modules</h3><p>对使用者暴露面越小越好</p>
<h3 id="Classitis-类的炎症"><a href="#Classitis-类的炎症" class="headerlink" title="Classitis(类的炎症)"></a>Classitis(类的炎症)</h3><p>类不是越小越好，无意义的拆分只会导致额外的复杂度。</p>
<h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>通过将模块的接口与其实现分离，我们可以将实现的复杂性对系统的其余部分进行隐藏。模块的用户只需要理解接口提供的抽象。在设计类和其他模块时，最重要的问题是使它们深入，这样它们就具有简单的接口用于常见用例，同时仍然提供重要的功能。这最大程度地隐藏了复杂性的量。</p>
<h2 id="信息隐藏（和泄露）"><a href="#信息隐藏（和泄露）" class="headerlink" title="信息隐藏（和泄露）"></a>信息隐藏（和泄露）</h2><blockquote>
<p>The most important technique for achieving deep modules is information hiding.</p>
</blockquote>
<blockquote>
<p>Information hiding reduces complexity in two ways. </p>
</blockquote>
<blockquote>
<p>First, it simplifies the interface to a module. </p>
</blockquote>
<blockquote>
<p>Second, information hiding makes it easier to evolve the system.</p>
</blockquote>
<h3 id="Temporal-decomposition-时空分解"><a href="#Temporal-decomposition-时空分解" class="headerlink" title="Temporal decomposition(时空分解)"></a>Temporal decomposition(时空分解)</h3><p>通过功能执行的时间顺序来涉及代码容易导致信息泄露。</p>
<blockquote>
<p>Order usually does matter, so it will be reflected somewhere in the application.</p>
</blockquote>
<blockquote>
<p>When designing modules, focus on the knowledge that’s needed to perform each task, not the order in which tasks occur.</p>
</blockquote>
<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><p>信息隐藏和深度模块密切相关。如果一个模块隐藏了大量信息，那往往会增加模块提供的功能数量，同时减少其接口。这使得模块更深。相反，如果一个模块没有隐藏太多信息，那么要么它功能不多，要么它的接口复杂；无论哪种情况，该模块都是浅的。在将系统分解为模块时，尽量不要受到运行时操作顺序的影响；这将使您进入时间分解的路径，导致信息泄露和浅层模块。相反，考虑一下执行应用程序任务所需的不同知识片段，并设计每个模块来封装其中的一个或几个知识片段。这将产生一个清晰简洁的设计，其中包含深度模块。</p>
<h2 id="为通用目标设计的模块应该更“深”"><a href="#为通用目标设计的模块应该更“深”" class="headerlink" title="为通用目标设计的模块应该更“深”"></a>为通用目标设计的模块应该更“深”</h2><p>通用接口相对于特定接口具有许多优势。它们往往更简单，方法更少但更深入。它们还能在类之间提供更清晰的分离，而特定接口往往会在类之间泄露信息。使您的模块具有一定的通用性是减少整个系统复杂性的最佳途径之一。</p>
<blockquote>
<p>One of the most important elements of software design is determining who needs to know what, and when.</p>
</blockquote>
<h3 id="何时需要一个更通用的模块？"><a href="#何时需要一个更通用的模块？" class="headerlink" title="何时需要一个更通用的模块？"></a>何时需要一个更通用的模块？</h3><ul>
<li>What is the simplest interface that will cover all my current needs?</li>
<li>In how many situations will this method be used?</li>
<li>Is this API easy to use for my current needs?</li>
</ul>
<h2 id="不同的应用分层有不同的抽象内容"><a href="#不同的应用分层有不同的抽象内容" class="headerlink" title="不同的应用分层有不同的抽象内容"></a>不同的应用分层有不同的抽象内容</h2><h3 id="Pass-through-methods（透传的方法）"><a href="#Pass-through-methods（透传的方法）" class="headerlink" title="Pass-through methods（透传的方法）"></a>Pass-through methods（透传的方法）</h3><p>透传的方法会让模块变“浅”（将下层的方法提供出来，扩大了接口暴露面）。也会让类之间的职责拆分变得模糊。</p>
<h3 id="什么时候重复的接口是ok的？"><a href="#什么时候重复的接口是ok的？" class="headerlink" title="什么时候重复的接口是ok的？"></a>什么时候重复的接口是ok的？</h3><p>dispatcher（调度器）模式的时候是ok的。</p>
<h3 id="Decorators（装饰器模式）"><a href="#Decorators（装饰器模式）" class="headerlink" title="Decorators（装饰器模式）"></a>Decorators（装饰器模式）</h3><blockquote>
<p>Decorator classes often contain many pass-through methods. </p>
</blockquote>
<blockquote>
<p>Sometimes decorators make sense, but there is usually a better alternative.</p>
</blockquote>
<h3 id="Pass-through-variables"><a href="#Pass-through-variables" class="headerlink" title="Pass-through variables"></a>Pass-through variables</h3><p>使用context（上下文）来代替透传变量。</p>
<h3 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h3><p>每个添加到系统中的设计基础设施，比如接口、参数、函数、类或定义，都会增加复杂性，因为开发人员必须了解这个元素。为了使一个元素对抗复杂性产生净增益，它必须消除一些在设计元素缺失时会存在的复杂性。否则，最好不使用该特定元素来实现系统。例如，一个类可以通过封装功能来减少复杂性，这样类的使用者就不需要知道这些细节。</p>
<p>“不同层次，不同抽象”的规则只是这个想法的一种应用：如果不同层次具有相同的抽象，比如传递方法或装饰者，那么它们很可能没有提供足够的好处来补偿它们所代表的额外基础设施。同样，传递参数要求每个方法都意识到它们的存在（增加了复杂性），而并没有提供额外的功能。</p>
<h2 id="Pull-Complexity-Downwards（复杂度下放）"><a href="#Pull-Complexity-Downwards（复杂度下放）" class="headerlink" title="Pull Complexity Downwards（复杂度下放）"></a>Pull Complexity Downwards（复杂度下放）</h2><p>在开发模块时，要寻找机会多承担一些额外的困难，以减少用户的困难。</p>
<blockquote>
<p>it is more important for a module to have a simple interface than a simple implementation.</p>
</blockquote>
<h2 id="放在一起更好还是分开？"><a href="#放在一起更好还是分开？" class="headerlink" title="放在一起更好还是分开？"></a>放在一起更好还是分开？</h2><ul>
<li>Bring together if information is shared</li>
<li>Bring together if it will simplify the interface</li>
<li>Bring together to eliminate duplication</li>
<li>Separate general-purpose and special-purpose code</li>
</ul>
<blockquote>
<p>Each method should do one thing and do it completely.</p>
</blockquote>
<h2 id="Define-Errors-Out-Of-Existence（通过定义来消除错误）"><a href="#Define-Errors-Out-Of-Existence（通过定义来消除错误）" class="headerlink" title="Define Errors Out Of Existence（通过定义来消除错误）"></a>Define Errors Out Of Existence（通过定义来消除错误）</h2><h3 id="为什么异常会增加复杂度"><a href="#为什么异常会增加复杂度" class="headerlink" title="为什么异常会增加复杂度"></a>为什么异常会增加复杂度</h3><p>错误处理会链式传递额外的信息。</p>
<p>消除异常处理复杂性的最佳方法是定义您的API，使其不产生需要处理的异常：通过定义消除错误存在的可能性。</p>
<p>ps: Linux设计哲学：没事的时候别乱报错。</p>
<blockquote>
<p>classes with lots of exceptions have complex interfaces, and they are shallower than classes with fewer exceptions.</p>
</blockquote>
<blockquote>
<p>reduce the number of places where exceptions have to be handled. </p>
</blockquote>
<h3 id="Just-crash"><a href="#Just-crash" class="headerlink" title="Just crash"></a>Just crash</h3><p>fail fast机制。</p>
<h2 id="Design-it-Twice（设计两次）"><a href="#Design-it-Twice（设计两次）" class="headerlink" title="Design it Twice（设计两次）"></a>Design it Twice（设计两次）</h2><blockquote>
<p>The design-it-twice approach not only improves your designs, but it also improves your design skills. The process of devising and comparing multiple approaches will teach you about the factors that make designs better or worse. Over time, this will make it easier for you to rule out bad designs and hone in on really great ones.</p>
</blockquote>
<h2 id="Why-Write-Comments-The-Four-Excuses"><a href="#Why-Write-Comments-The-Four-Excuses" class="headerlink" title="Why Write Comments? The Four Excuses"></a>Why Write Comments? The Four Excuses</h2><p>一次击破不写注释的四个借口：</p>
<h3 id="Good-code-is-self-documenting"><a href="#Good-code-is-self-documenting" class="headerlink" title="Good code is self-documenting."></a>Good code is self-documenting.</h3><p>接口文档是必须的，描述接口的功能和提供一些示例</p>
<blockquote>
<p>If users must read the code of a method in order to use it, then there is no abstraction: all of the complexity of the method is exposed.</p>
</blockquote>
<h3 id="I-don’t-have-time-to-write-comments"><a href="#I-don’t-have-time-to-write-comments" class="headerlink" title="I don’t have time to write comments"></a>I don’t have time to write comments</h3><p>注释先行，理清思路。</p>
<h3 id="Comments-get-out-of-date-and-become-misleading"><a href="#Comments-get-out-of-date-and-become-misleading" class="headerlink" title="Comments get out of date and become misleading"></a>Comments get out of date and become misleading</h3><p>Code reviews的重要性。 AI生成文档也是一条路。</p>
<h3 id="All-the-comments-I-have-seen-are-worthless"><a href="#All-the-comments-I-have-seen-are-worthless" class="headerlink" title="All the comments I have seen are worthless"></a>All the comments I have seen are worthless</h3><p>keep yourself simple and stupid.</p>
<p>后面几章都是对注释的啰嗦就不细写了。</p>
<ul>
<li>Comments Should Describe Things that Aren’t Obvious from the Code</li>
<li>Choosing Names</li>
<li>Write The Comments First</li>
</ul>
<h2 id="一致性（减少心智负担和增加团队规范）"><a href="#一致性（减少心智负担和增加团队规范）" class="headerlink" title="一致性（减少心智负担和增加团队规范）"></a>一致性（减少心智负担和增加团队规范）</h2><p>一致性是投资思维的另一个例子。确保一致性需要额外的一些工作：需要努力确定惯例，创建自动检查器，寻找类似情况以在新代码中模仿，并在代码审查中进行团队教育。这项投资的回报是，您的代码将更加明显。开发人员将能够更快速、更准确地理解代码的行为，这将使他们能够更快地工作，减少错误。</p>
<h2 id="代码应该是显而易见的"><a href="#代码应该是显而易见的" class="headerlink" title="代码应该是显而易见的"></a>代码应该是显而易见的</h2><p>从信息角度来考虑明显性的另一种方式是，如果代码不明显，通常意味着读者缺乏关于代码的重要信息：在 RaftClient 示例中，读者可能不知道 RaftClient 构造函数创建了新的线程；在 Pair 示例中，读者可能不知道 result.getKey() 返回当前期数的数字。</p>
<p>要使代码明显，您必须确保读者始终拥有理解代码所需的信息。您可以通过三种方式实现这一点。最好的方式是减少所需信息的量，使用抽象和消除特殊情况等设计技术。其次，您可以利用读者在其他情境中已经获得的信息（例如，遵循惯例和符合期望），这样读者就不必为了理解您的代码而学习新的信息。第三，您可以在代码中向他们呈现重要信息，使用良好的命名和战略性注释等技术。</p>
<h2 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h2><p>本书讨论的是一个问题：复杂性。处理复杂性是软件设计中最重要的挑战。它是导致系统难以构建和维护的原因，而且通常也会使系统变得缓慢。在本书中，我试图描述导致复杂性的根本原因，如依赖性和晦涩性。我讨论了可以帮助您识别不必要复杂性的红旗，例如信息泄露、不必要的错误条件或过于通用的名称。我提出了一些通用的思路，可以用来创建更简单的软件系统，比如努力使类深入且通用，将错误定义为不存在，并将接口文档与实现文档分开。最后，我讨论了产生简单设计所需的投资思维。</p>
<p>所有这些建议的缺点在于它们会在项目的早期阶段增加额外的工作量。此外，如果您不习惯思考设计问题，那么在学习良好的设计技术时您会变得更加缓慢。如果对您来说唯一重要的是尽快让您当前的代码运行起来，那么思考设计将会显得像是妨碍您真正目标的苦差事。</p>
<p>另一方面，如果良好的设计对您来说是一个重要目标，那么本书中的理念应该会让编程变得更有趣。设计是一个迷人的谜题：如何用最简单的结构解决特定的问题？探索不同的方法是很有趣的，而且发现既简单又强大的解决方案是一种很棒的感觉。一个清晰、简单和明显的设计是一件美妙的事情。</p>
<p>此外，您在良好设计上所做的投资将很快得到回报。在项目开始阶段精心定义的模块将在以后反复重用时节省您的时间。您六个月前编写的清晰文档将在您返回代码以添加新功能时为您节省时间。您花在磨练设计技能上的时间也将得到回报：随着您的技能和经验的增长，您会发现自己能够越来越快地产生良好的设计。一旦掌握了技巧，良好的设计实际上并不比草率设计花费更多时间。</p>
<p>成为一个优秀的设计师的回报是，您可以将更多的时间花在有趣的设计阶段。糟糕的设计师大部分时间都在追踪复杂而脆弱的代码中的错误。如果您提高了自己的设计技能，不仅能更快地生产出更高质量的软件，而且软件开发过程也会更加愉快。</p>
<h2 id="Red-Flag（坏味道）"><a href="#Red-Flag（坏味道）" class="headerlink" title="Red Flag（坏味道）"></a>Red Flag（坏味道）</h2><h3 id="Shallow-Module"><a href="#Shallow-Module" class="headerlink" title="Shallow Module"></a>Shallow Module</h3><blockquote>
<p>A shallow module is one whose interface is complicated relative to the functionality it provides. Shallow modules don’t help much in the battle against complexity, because the benefit they provide (not having to learn about how they work internally) is negated by the cost of learning and using their interfaces. Small modules tend to be shallow.</p>
</blockquote>
<h3 id="Information-Leakage"><a href="#Information-Leakage" class="headerlink" title="Information Leakage"></a>Information Leakage</h3><blockquote>
<p>Information leakage occurs when the same knowledge is used in multiple places, such as two different classes that both understand the format of a particular type of file.</p>
</blockquote>
<h3 id="Temporal-Decomposition"><a href="#Temporal-Decomposition" class="headerlink" title="Temporal Decomposition"></a>Temporal Decomposition</h3><blockquote>
<p>In temporal decomposition, execution order is reflected in the code structure: operations that happen at different times are in different methods or classes. If the same knowledge is used at different points in execution, it gets encoded in multiple places, resulting in information leakage.</p>
</blockquote>
<h3 id="Overexposure"><a href="#Overexposure" class="headerlink" title="Overexposure"></a>Overexposure</h3><blockquote>
<p>If the API for a commonly used feature forces users to learn about other features that are rarely used, this increases the cognitive load on users who don’t need the rarely used features.</p>
</blockquote>
<h3 id="Repetition"><a href="#Repetition" class="headerlink" title="Repetition"></a>Repetition</h3><blockquote>
<p>If the same piece of code (or code that is almost the same) appears over and over again, that’s a red flag that you haven’t found the right abstractions.</p>
</blockquote>
<h3 id="Special-General-Mixture"><a href="#Special-General-Mixture" class="headerlink" title="Special-General Mixture"></a>Special-General Mixture</h3><blockquote>
<p>This red flag occurs when a general-purpose mechanism also contains code specialized for a particular use of that mechanism. This makes the mechanism more complicated and creates information leakage between the mechanism and the particular use case: future modifications to the use case are likely to require changes to the underlying mechanism as well.</p>
</blockquote>
<h3 id="Conjoined-Methods"><a href="#Conjoined-Methods" class="headerlink" title="Conjoined Methods"></a>Conjoined Methods</h3><blockquote>
<p>It should be possible to understand each method independently. If you can’t understand the implementation of one method without also understanding the implementation of another, that’s a red flag. This red flag can occur in other contexts as well: if two pieces of code are physically separated, but each can only be understood by looking at the other, that is a red flag.</p>
</blockquote>
<h3 id="Nonobvious-Code"><a href="#Nonobvious-Code" class="headerlink" title="Nonobvious Code"></a>Nonobvious Code</h3><blockquote>
<p>If the meaning and behavior of code cannot be understood with a quick reading, it is a red flag. Often this means that there is important information that is not immediately clear to someone reading the code.</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://misakatang.cn/2023/07/18/refactor-java-code-with-gpt4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/misaka.jpg">
      <meta itemprop="name" content="MisakaTang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MisakaTang's Blog">
      <meta itemprop="description" content="The limits of my language are the limits of my world">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | MisakaTang's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2023/07/18/refactor-java-code-with-gpt4/" class="post-title-link" itemprop="url">破事水：用GPT4重构一段Java代码</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-07-18 11:45:14" itemprop="dateCreated datePublished" datetime="2023-07-18T11:45:14+00:00">2023-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-14 08:33:24" itemprop="dateModified" datetime="2024-03-14T08:33:24+00:00">2024-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/%E5%88%86%E7%B1%BB/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="ask-如何使用模板方法重构下面的代码："><a href="#ask-如何使用模板方法重构下面的代码：" class="headerlink" title="ask: 如何使用模板方法重构下面的代码："></a>ask: 如何使用模板方法重构下面的代码：</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportOrder</span><span class="params">(OrderQueryDTO queryDTO, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="type">ExcelWriter</span> <span class="variable">excelWriter</span> <span class="operator">=</span> EasyExcel.write(EasyExcelUtil.getOutputStream(<span class="string">&quot;订单导出&quot;</span>, response)).build();</span><br><span class="line"></span><br><span class="line">    <span class="type">WriteSheet</span> <span class="variable">writeSheet</span> <span class="operator">=</span> EasyExcel.writerSheet(<span class="number">1</span>, <span class="string">&quot;订单明细&quot;</span>)</span><br><span class="line">            .head(OrderExportVO.class).build();</span><br><span class="line">    <span class="type">WriteSheet</span> <span class="variable">writeSheet2</span> <span class="operator">=</span> EasyExcel.writerSheet(<span class="number">2</span>, <span class="string">&quot;订单商品明细&quot;</span>)</span><br><span class="line">            .head(OrderGoodsExportVO.class).build();</span><br><span class="line"></span><br><span class="line">    <span class="type">PageDto</span> <span class="variable">pageDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageDto</span>(<span class="number">1</span>, <span class="number">1000</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        IPage&lt;Order&gt; page = <span class="built_in">this</span>.page(setPage(pageDto), getLQW(queryDTO));</span><br><span class="line">        List&lt;Order&gt; records = page.getRecords();</span><br><span class="line">        List&lt;OrderExportVO&gt; <span class="keyword">exports</span> = setUpOrderExportVO(records);</span><br><span class="line"></span><br><span class="line">        List&lt;OrderGoodsExportVO&gt; orderGoodsExports = setUpOrderGoodsExportExportVO(records);</span><br><span class="line"></span><br><span class="line">        excelWriter.write(<span class="keyword">exports</span>, writeSheet);</span><br><span class="line">        excelWriter.write(orderGoodsExports, writeSheet2);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (page.getCurrent() &gt;= page.getPages()) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        pageDto.setPage(pageDto.getPage() + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    excelWriter.finish();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="answer"><a href="#answer" class="headerlink" title="answer:"></a>answer:</h3><p>这里的模板方法模式可以用来将导出过程的骨架定义在一个抽象类中，然后通过子类来实现特定的步骤。这样可以让代码更加清晰和可扩展。</p>
<p>首先，我们创建一个<code>ExportStep</code>抽象类，定义导出过程的骨架：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ExportStep</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> ExcelWriter excelWriter;</span><br><span class="line">    <span class="keyword">protected</span> WriteSheet writeSheet;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExportStep</span><span class="params">(ExcelWriter excelWriter, String sheetName, Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.excelWriter = excelWriter;</span><br><span class="line">        <span class="built_in">this</span>.writeSheet = EasyExcel.writerSheet(sheetName).head(clazz).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;?&gt; setupExportData(List&lt;Order&gt; records);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeData</span><span class="params">(List&lt;Order&gt; records)</span> &#123;</span><br><span class="line">        List&lt;?&gt; data = setupExportData(records);</span><br><span class="line">        excelWriter.write(data, writeSheet);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，我们创建具体的导出类，实现特定的步骤：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderExportStep</span> <span class="keyword">extends</span> <span class="title class_">ExportStep</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderExportStep</span><span class="params">(ExcelWriter excelWriter)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(excelWriter, <span class="string">&quot;订单明细&quot;</span>, OrderExportVO.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;OrderExportVO&gt; <span class="title function_">setupExportData</span><span class="params">(List&lt;Order&gt; records)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> setUpOrderExportVO(records);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderGoodsExportStep</span> <span class="keyword">extends</span> <span class="title class_">ExportStep</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderGoodsExportStep</span><span class="params">(ExcelWriter excelWriter)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(excelWriter, <span class="string">&quot;订单商品明细&quot;</span>, OrderGoodsExportVO.class);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;OrderGoodsExportVO&gt; <span class="title function_">setupExportData</span><span class="params">(List&lt;Order&gt; records)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> setUpOrderGoodsExportExportVO(records);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后，在主方法中使用具体的导出类来进行导出：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportOrder</span><span class="params">(OrderQueryDTO queryDTO, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="type">ExcelWriter</span> <span class="variable">excelWriter</span> <span class="operator">=</span> EasyExcel.write(EasyExcelUtil.getOutputStream(<span class="string">&quot;订单导出&quot;</span>, response)).build();</span><br><span class="line"></span><br><span class="line">    ExportStep[] steps = <span class="keyword">new</span> <span class="title class_">ExportStep</span>[] &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">OrderExportStep</span>(excelWriter),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">OrderGoodsExportStep</span>(excelWriter)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">PageDto</span> <span class="variable">pageDto</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PageDto</span>(<span class="number">1</span>, <span class="number">1000</span>, <span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        IPage&lt;Order&gt; page = <span class="built_in">this</span>.page(setPage(pageDto), getLQW(queryDTO));</span><br><span class="line">        List&lt;Order&gt; records = page.getRecords();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (ExportStep step : steps) &#123;</span><br><span class="line">            step.writeData(records);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (page.getCurrent() &gt;= page.getPages()) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        pageDto.setPage(pageDto.getPage() + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    excelWriter.finish();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，我们就使用模板方法模式重构了这段代码，使得代码更加清晰和可扩展。</p>
<h2 id="ask-可以把上述代码中的while循环改成迭代器模式吗"><a href="#ask-可以把上述代码中的while循环改成迭代器模式吗" class="headerlink" title="ask: 可以把上述代码中的while循环改成迭代器模式吗"></a>ask: 可以把上述代码中的while循环改成迭代器模式吗</h2><h3 id="answer-1"><a href="#answer-1" class="headerlink" title="answer:"></a>answer:</h3><p>是的，我们可以使用迭代器模式来改造这个while循环。迭代器模式提供了一种方法访问一个容器对象中各个元素，而又不暴露该对象的内部细节。</p>
<p>首先，我们需要创建一个迭代器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderIterator</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;List&lt;Order&gt;&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OrderService orderService;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> OrderQueryDTO queryDTO;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> PageDto pageDto;</span><br><span class="line">    <span class="keyword">private</span> IPage&lt;Order&gt; currentPage;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">OrderIterator</span><span class="params">(OrderService orderService, OrderQueryDTO queryDTO, PageDto pageDto)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.orderService = orderService;</span><br><span class="line">        <span class="built_in">this</span>.queryDTO = queryDTO;</span><br><span class="line">        <span class="built_in">this</span>.pageDto = pageDto;</span><br><span class="line">        <span class="built_in">this</span>.currentPage = orderService.page(setPage(pageDto), getLQW(queryDTO));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> currentPage.getCurrent() &lt; currentPage.getPages();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Order&gt; <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Order&gt; records = currentPage.getRecords();</span><br><span class="line">        pageDto.setPage(pageDto.getPage() + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">this</span>.currentPage = orderService.page(setPage(pageDto), getLQW(queryDTO));</span><br><span class="line">        <span class="keyword">return</span> records;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，我们在<code>exportOrder</code>方法中使用<code>OrderIterator</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportOrder</span><span class="params">(OrderQueryDTO queryDTO, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="type">ExcelWriter</span> <span class="variable">excelWriter</span> <span class="operator">=</span> EasyExcel.write(EasyExcelUtil.getOutputStream(<span class="string">&quot;订单导出&quot;</span>, response)).build();</span><br><span class="line"></span><br><span class="line">    ExportStep[] steps = <span class="keyword">new</span> <span class="title class_">ExportStep</span>[] &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">OrderExportStep</span>(excelWriter),</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">OrderGoodsExportStep</span>(excelWriter)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">OrderIterator</span> <span class="variable">orderIterator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderIterator</span>(<span class="built_in">this</span>, queryDTO, <span class="keyword">new</span> <span class="title class_">PageDto</span>(<span class="number">1</span>, <span class="number">1000</span>, <span class="literal">false</span>));</span><br><span class="line">    <span class="keyword">while</span> (orderIterator.hasNext()) &#123;</span><br><span class="line">        List&lt;Order&gt; records = orderIterator.next();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (ExportStep step : steps) &#123;</span><br><span class="line">            step.writeData(records);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    excelWriter.finish();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，我们就使用迭代器模式重构了这段代码，使得代码更加清晰和可扩展。</p>
<h2 id="ask-可以将上述代码的ExportStep改用责任链模式重构吗"><a href="#ask-可以将上述代码的ExportStep改用责任链模式重构吗" class="headerlink" title="ask: 可以将上述代码的ExportStep改用责任链模式重构吗"></a>ask: 可以将上述代码的ExportStep改用责任链模式重构吗</h2><h3 id="answer-2"><a href="#answer-2" class="headerlink" title="answer:"></a>answer:</h3><p>当然可以。责任链模式（Chain of Responsibility Pattern）是一种设计模式，其中对象的接收者形成一个链，并沿着这个链传递请求，直到一个对象处理它为止。这使得多个对象都有机会处理请求。</p>
<p>首先，我们需要修改<code>ExportStep</code>类，让它能够引用下一个<code>ExportStep</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">ExportStep</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> ExcelWriter excelWriter;</span><br><span class="line">    <span class="keyword">protected</span> WriteSheet writeSheet;</span><br><span class="line">    <span class="keyword">protected</span> ExportStep nextStep;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ExportStep</span><span class="params">(ExcelWriter excelWriter, String sheetName, Class&lt;?&gt; clazz)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.excelWriter = excelWriter;</span><br><span class="line">        <span class="built_in">this</span>.writeSheet = EasyExcel.writerSheet(sheetName).head(clazz).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;?&gt; setupExportData(List&lt;Order&gt; records);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeData</span><span class="params">(List&lt;Order&gt; records)</span> &#123;</span><br><span class="line">        List&lt;?&gt; data = setupExportData(records);</span><br><span class="line">        excelWriter.write(data, writeSheet);</span><br><span class="line">        <span class="keyword">if</span> (nextStep != <span class="literal">null</span>) &#123;</span><br><span class="line">            nextStep.writeData(records);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNextStep</span><span class="params">(ExportStep nextStep)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.nextStep = nextStep;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后，我们在主方法中使用责任链模式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exportOrder</span><span class="params">(OrderQueryDTO queryDTO, HttpServletResponse response)</span> &#123;</span><br><span class="line">    <span class="type">ExcelWriter</span> <span class="variable">excelWriter</span> <span class="operator">=</span> EasyExcel.write(EasyExcelUtil.getOutputStream(<span class="string">&quot;订单导出&quot;</span>, response)).build();</span><br><span class="line"></span><br><span class="line">    <span class="type">ExportStep</span> <span class="variable">orderExportStep</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderExportStep</span>(excelWriter);</span><br><span class="line">    <span class="type">ExportStep</span> <span class="variable">orderGoodsExportStep</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderGoodsExportStep</span>(excelWriter);</span><br><span class="line">    orderExportStep.setNextStep(orderGoodsExportStep);</span><br><span class="line"></span><br><span class="line">    <span class="type">OrderIterator</span> <span class="variable">orderIterator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OrderIterator</span>(<span class="built_in">this</span>, queryDTO, <span class="keyword">new</span> <span class="title class_">PageDto</span>(<span class="number">1</span>, <span class="number">1000</span>, <span class="literal">false</span>));</span><br><span class="line">    <span class="keyword">while</span> (orderIterator.hasNext()) &#123;</span><br><span class="line">        List&lt;Order&gt; records = orderIterator.next();</span><br><span class="line">        orderExportStep.writeData(records);</span><br><span class="line">    &#125;</span><br><span class="line">    excelWriter.finish();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，我们就使用责任链模式重构了这段代码，使得代码更加清晰和可扩展。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/34/">34</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="user"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">MisakaTang</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/TangMisaka23001" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","mhchem":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
