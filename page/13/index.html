<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"misakatang.cn","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"style":null,"show_result":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="The limits of my language are the limits of my world">
<meta property="og:type" content="website">
<meta property="og:title" content="MisakaTang&#39;s Blog">
<meta property="og:url" content="http://misakatang.cn/page/13/index.html">
<meta property="og:site_name" content="MisakaTang&#39;s Blog">
<meta property="og:description" content="The limits of my language are the limits of my world">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="MisakaTang">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://misakatang.cn/page/13/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/13/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>MisakaTang's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-4TSLH4NC9H"></script>
  <script class="next-config" data-name="google_analytics" type="application/json">{"tracking_id":"G-4TSLH4NC9H","only_pageview":false}</script>
  <script src="/js/third-party/analytics/google-analytics.js"></script>

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?de7c77febeeac252eee468207ae11ce4"></script>



  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "jtb4czrfeu");
</script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="MisakaTang's Blog" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">MisakaTang's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="MisakaTang"
      src="/images/misaka.jpg">
  <p class="site-author-name" itemprop="name">MisakaTang</p>
  <div class="site-description" itemprop="description">The limits of my language are the limits of my world</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/%E5%BD%92%E6%A1%A3/">
          <span class="site-state-item-count">101</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">100</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/TangMisaka23001" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;TangMisaka23001" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:mikasatang@gmail.com" title="E-Mail → mailto:mikasatang@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          链接
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="http://blog.bbchen.top/" title="http:&#x2F;&#x2F;blog.bbchen.top" rel="noopener" target="_blank">BB chen的漂流记</a>
            </li>
            <li class="links-of-blogroll-item">
              <a href="http://blog.zhuzhenyuan.cn/" title="http:&#x2F;&#x2F;blog.zhuzhenyuan.cn" rel="noopener" target="_blank">Aurthur_的博客</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://misakatang.cn/2019/09/08/what-new-things-this-week/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/misaka.jpg">
      <meta itemprop="name" content="MisakaTang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MisakaTang's Blog">
      <meta itemprop="description" content="The limits of my language are the limits of my world">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | MisakaTang's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/09/08/what-new-things-this-week/" class="post-title-link" itemprop="url">这周搞的一些新东西</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-08 12:03:52" itemprop="dateCreated datePublished" datetime="2019-09-08T12:03:52+00:00">2019-09-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-14 08:33:24" itemprop="dateModified" datetime="2024-03-14T08:33:24+00:00">2024-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/%E5%88%86%E7%B1%BB/%E7%94%9F%E6%B4%BB/" itemprop="url" rel="index"><span itemprop="name">生活</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>话到嘴边又不知道该怎么描述,也算是拾起了很久没用的博客吧,这也算是自己少见的文字输出方式了所以还是来写一写.</p>
<p>之所以会写<strong>这周搞的一些新东西</strong>这样的博客,主要是这周摸🐟的时光似乎有些多了,也是四处搞了很多新东西和一些之前遗留的事,就来记录一下吧.</p>
<h1 id="敏捷学习仓库合并"><a href="#敏捷学习仓库合并" class="headerlink" title="敏捷学习仓库合并"></a>敏捷学习仓库合并</h1><p>在许久之前看了<a target="_blank" rel="noopener" href="http://insights.thoughtworkers.org/agile-learning-method-base-on-github/">基于GitHub的敏捷学习方法之道与术</a>之后就深受影响然后搞了一个仓库<a target="_blank" rel="noopener" href="https://github.com/TangMisaka23001/Agile-Learning">Agile-Learning</a>也坚持搞了一段时间(MySQL文档翻译就是这样促成的),但是过年回来之后惰性发作也就许久没有再去动这个仓库也就闲置了许久,最近打算重新使用之后发现private的仓库不能无偿使用wiki,也就借着public的机会把这个仓库和github.io的仓库给合并了顺便整理了一下吧.</p>
<p>因为写博客的分支是在backup上的,所以对博客访问也没有什么影响,也是方便自己管理,之前没有public敏捷学习的仓库也是因为打算实践一段时间找到自己的使用方式之后再public出来,现在也是想用wiki就用public的方式来督促一下自己吧算是.</p>
<h1 id="用wiki整合知识"><a href="#用wiki整合知识" class="headerlink" title="用wiki整合知识"></a>用wiki整合知识</h1><p>承接上文现在也是打算吧一些开发和日常过程中自己Google过的不熟悉的东西整理到wiki里面去了(毕竟记性不好,还是写下来靠谱):<br><a target="_blank" rel="noopener" href="https://github.com/TangMisaka23001/TangMisaka23001.github.io/wiki">个人知识点整理用wiki</a></p>
<p>对于wiki的话其实也就是一个MarkDown文件的文件夹,大致的目录如下:<br><img src="https://i.loli.net/2019/09/08/i32CrFwuNR9KgXA.png"><br>主要是*_Footer.md*,<em>_Sidebar.md</em>,<em>Home.md</em>三个文件,需要注意的是没有<em>Home.md</em>这个文件的话进入wiki看到的就是文件列表了.还有一点需要吐槽的是wiki默认的git方式是<em>https</em>的,需要自己手动改成ssh方式的不然就还是需要账号密码而不能用密钥的方式了.</p>
<h1 id="博客HTTPS"><a href="#博客HTTPS" class="headerlink" title="博客HTTPS"></a>博客HTTPS</h1><p>关于https,很早之前就已经用上了,当时使用的是<a target="_blank" rel="noopener" href="https://www.cloudflare.com/">cloudflare</a>的免费HTTPS方式,但是现在发现GitHub Pages已经自己支持HTTPS了,就改用GitHub自带的了:<br><img src="https://i.loli.net/2019/09/08/DUvbmxSuV6efX2q.png"> </p>
<h1 id="VSCode-remote"><a href="#VSCode-remote" class="headerlink" title="VSCode remote"></a>VSCode remote</h1><p>因为现在一直在用VSCode写MarkDown而在经历了整合仓库之后在clone的时候发现网速巨慢,大概需要10-30min才能把仓库clone下来,实在是无法忍受之后想到了用阿里云的服务器来写博客,之前也是对VSCode remote略有耳闻就Google并且尝试了一下,目前来看在写Markdown这一块还是很不错的并且由于文件保存在服务器上所以哪怕没有保存的修改也不会丢失.</p>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li>下载openssh:<a target="_blank" rel="noopener" href="https://github.com/PowerShell/Win32-OpenSSH/releases/download/v8.0.0.0p1-Beta/OpenSSH-Win64.zip">OpenSSH-Win64.zip</a></li>
<li>添加到Path</li>
<li>PowerShell使用<code>ssh xxx@xxx.xxx.xxx</code>尝试连接服务器</li>
<li>VSCode安装Remote的插件</li>
<li>在本地的.ssh&#x2F;config文件下进行服务器的配置:<br><img src="https://i.loli.net/2019/09/08/8IgnytEAW3VuzLF.png"></li>
<li>完成之后如下就已经可以了:<br><img src="https://i.loli.net/2019/09/08/zc2Om3BN5KqdeRa.png"></li>
</ol>
<h1 id="Windwos-Terminal-WSL"><a href="#Windwos-Terminal-WSL" class="headerlink" title="Windwos Terminal &amp;&amp; WSL"></a>Windwos Terminal &amp;&amp; WSL</h1><p>先来一个效果图吧(想自定义主题的但是目前好像文章不是很多还得好好研究一下):<br><img src="https://i.loli.net/2019/09/08/bYMize3ckp8lst7.png"> </p>
<p>Win10下的安装也很简单就不在赘述了,下面就放一下配置文件好了:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;globals&quot;</span> <span class="punctuation">:</span> </span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;alwaysShowTabs&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;copyOnSelect&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;defaultProfile&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;&#123;9acb9455-ca41-5af7-950f-6bca1bc9722f&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;initialCols&quot;</span> <span class="punctuation">:</span> <span class="number">120</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;initialRows&quot;</span> <span class="punctuation">:</span> <span class="number">30</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;keybindings&quot;</span> <span class="punctuation">:</span> </span><br></pre></td></tr></table></figure>
<p>这里主要是<code>defaultProfile</code>这个字段,对应下面每个terminal类型的<code>guid</code>,我改成了默认启动WSL的窗口.</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;profiles&quot;</span> <span class="punctuation">:</span> </span><br><span class="line">    <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;acrylicOpacity&quot;</span> <span class="punctuation">:</span> <span class="number">0.75</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;closeOnExit&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;colorScheme&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Vintage&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;commandline&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;wsl.exe&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cursorColor&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;#FFFFFF&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;cursorShape&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;bar&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fontFace&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;Fira Code&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;fontSize&quot;</span> <span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;guid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;&#123;9acb9455-ca41-5af7-950f-6bca1bc9722f&#125;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;historySize&quot;</span> <span class="punctuation">:</span> <span class="number">9001</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;icon&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;ms-appx:///ProfileIcons/&#123;9acb9455-ca41-5af7-950f-6bca1bc9722f&#125;.png&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;WSL&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;padding&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;0, 0, 0, 0&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;snapOnInput&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;startingDirectory&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;//wsl$/Ubuntu/home/tang&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;useAcrylic&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<p>这是WSL的配置文件,<code>icon</code>这个是需要更换的,目录是在(我的文件夹权限有点问题就用命令行来查看了):<br><img src="https://i.loli.net/2019/09/08/5bvTHJOGSzMClR7.png"> </p>
<p>把<code>guid</code>和<code>icon</code>一起改掉就ok了.</p>
<p>我还更换了一下字体:<code>&quot;fontFace&quot; : &quot;Fira Code&quot;,</code> 关于字体可以自行Google.</p>
<p>终端主题在下面的<code>&quot;schemes&quot; : </code>里有自带默认的几个风格.修改到<code>&quot;colorScheme&quot; : &quot;Vintage&quot;,</code>这个字段就可以应用.</p>
<p>可以看出这一次巨硬还是很良心的,而且配置文件也很容易修改,可以说是Win开发的一大福音了.</p>
<h1 id="id-rsa"><a href="#id-rsa" class="headerlink" title="id_rsa"></a>id_rsa</h1><blockquote>
<p>以前的我只知道莽,无脑生成密钥就完事了.</p>
</blockquote>
<p>但是在经历了许多环境和服务器的摧残之后,还是认识到了使用一套自己的密钥的重要性了,于是在生成了一套之后把GitHub和服务器都替换了一下,现在就very方便了(顺便保存在了1password里).</p>
<h1 id="Pi-hole"><a href="#Pi-hole" class="headerlink" title="Pi_hole"></a>Pi_hole</h1><p>可以查看示例:<a target="_blank" rel="noopener" href="http://dns.misakatang.cn/">Pi_hole Admin</a></p>
<p>知道这东西是在老莱的频道发现的:<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av65936575">【官方双语】世界清净了…用树莓派屏蔽所有在线广告！#linus谈科技</a></p>
<p>感觉还挺有意思的但是介于没有树莓派然后又想到<em>服务器不是有公网ip吗</em>,于是就在阿里服务器上搭了一个,一开始感觉还非常不错但是在经历了更多网页的洗礼之后发现还是不太行,现在用的是adblock+Pi hole的双重过滤方式.</p>
<p>需要注意的是如果在服务器上部署需要在安全组里开放53的UDP端口,是DNS需要的端口.</p>
<p>安装的话由于有一键脚本,直接跟着做就成了所以也就不在赘述了.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://install.pi-hole.net | bash</span><br></pre></td></tr></table></figure>

<p>(后期补充:docker脚本)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker run -d \</span><br><span class="line">    --name pihole \</span><br><span class="line">    -p 53:53/tcp -p 53:53/udp \</span><br><span class="line">    -p 8081:80 \</span><br><span class="line">    -p 443:443 \</span><br><span class="line">    -e TZ=<span class="string">&quot;Asia/Shanghai&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;<span class="subst">$(pwd)</span>/etc-pihole/:/etc/pihole/&quot;</span> \</span><br><span class="line">    -v <span class="string">&quot;<span class="subst">$(pwd)</span>/etc-dnsmasq.d/:/etc/dnsmasq.d/&quot;</span> \</span><br><span class="line">    --dns=127.0.0.1 --dns=1.1.1.1 \</span><br><span class="line">    --restart=unless-stopped \</span><br><span class="line">    pihole/pihole:latest</span><br></pre></td></tr></table></figure>

<h1 id="自建RSS"><a href="#自建RSS" class="headerlink" title="自建RSS"></a>自建RSS</h1><p>我也算是个轻度的RSS使用者了吧,之前一直在使用Inoreader但是最近发现广告变多了而且免费账户着实有些弟弟,就想着反正有个服务器就克服一下懒癌尝试一下吧.</p>
<p>然后Google了一顿还是发现之前看过的:<a target="_blank" rel="noopener" href="https://sspai.com/post/41302">如何搭建属于自己的 RSS 服务，高效精准获取信息</a>感觉还不错就跟着做了,不得不说:真香. 在docker的加持之下安装是非常之简单了,唯一的坑是Mercury 的全文插件,现在已经需要自建了, 然后参考了:<a target="_blank" rel="noopener" href="https://libertyleadingnetwork.blogspot.com/2019/03/dockertiny-rssmercurymercury-parser.html">通过Docker安装Tiny RSS，mercury全文插件及mercury-parser-api；申请域名通配符证书，安装nginx并配置ssl </a> 使用docker安装了Mercury Parser API.</p>
<p>直接使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 3000:3000 -d --restart=always  wangqiru/mercury-parser-api</span><br></pre></td></tr></table></figure>
<p>然后配置API地址就可以了,当然之前是使用API KEY的形式.</p>
<p>然后把Inoreader的订阅源导入过来就成了,有一点值得吐槽的是Inoreader导出的opml文件竟然是xml格式的,然后直接导入ttrss就会失败,但是改一下后缀就ok了.</p>
<h1 id="TabNine"><a href="#TabNine" class="headerlink" title="TabNine"></a><a target="_blank" rel="noopener" href="https://tabnine.com/">TabNine</a></h1><p>据说是<strong>杀手级AI代码补全工具</strong>,毕竟现在是”AI大数据”的时代就下载下来蹭一下热度呗,实际的使用体验还算是不错,写Markdown的时候竟然也会提示单词的补全,好评.</p>
<p>在idea也装了插件,补全智能程度还算是非常的不错,在填参数的时候甚至会帮你补全后面的’)’.</p>
<p>介绍的文章也很多我也就不再唠叨用就完事了(毕竟我只是个记录贴 :)</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://misakatang.cn/2019/09/03/read-Test-Driven-Development-By-Example/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/misaka.jpg">
      <meta itemprop="name" content="MisakaTang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MisakaTang's Blog">
      <meta itemprop="description" content="The limits of my language are the limits of my world">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | MisakaTang's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/09/03/read-Test-Driven-Development-By-Example/" class="post-title-link" itemprop="url">阅读:Test-Driven Development By Example</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-03 17:00:13" itemprop="dateCreated datePublished" datetime="2019-09-03T17:00:13+00:00">2019-09-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-14 08:33:24" itemprop="dateModified" datetime="2024-03-14T08:33:24+00:00">2024-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/%E5%88%86%E7%B1%BB/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Perface"><a href="#Perface" class="headerlink" title="Perface"></a>Perface</h1><p><strong>TDD rules:</strong></p>
<ol>
<li>write new code only if you first have a failing automated test.</li>
<li>eliminate duplication. 消除重复设计</li>
</ol>
<p><strong>Technical implications:</strong></p>
<ol>
<li>design organically: running code providing feedback between decisions.</li>
<li>write your own test.</li>
<li>development env must provide rapid response to small change.</li>
<li>design must be <em>highly cohesive, loosely coupled components(高内聚,低耦合)</em> to make <strong>testing easy</strong>.</li>
</ol>
<p><strong>Programing order:</strong></p>
<ol>
<li>Red-write a little that doesn’t work.</li>
<li>Green-make the test work quickly.</li>
<li>Refactor-eliminate all the duplication created.</li>
</ol>
<ul>
<li>红:写测试</li>
<li>绿:写代码通过测试</li>
<li>重构:消除重复设计,优化结构</li>
</ul>
<p><img src="https://i.loli.net/2019/09/02/4znXftjkJRSgiYp.jpg"></p>
<h1 id="Section-I-MoneyExample"><a href="#Section-I-MoneyExample" class="headerlink" title="Section I: MoneyExample"></a>Section I: MoneyExample</h1><ul>
<li>a <strong>to-do list</strong> to remind what need to do.</li>
<li>when write a test,imagine the perfect interface for operation.</li>
<li>Dependency is the key problem in software development at all scales.</li>
<li>If you can make steps too small, you can certainly make steps the right size.(为什么测试要足够小)</li>
</ul>
<p><strong>TDD cycle:</strong></p>
<ol>
<li>write a test.</li>
<li>make it run.</li>
<li>make it right.</li>
</ol>
<p>the goal is clean code works.</p>
<blockquote>
<p>First we can talk about whether the system should work like this or like that. Once we decide on the correct behavior, we can talk about the best way of achieving that behavior</p>
</blockquote>
<p>首先需要考虑系统是怎么样的,确定实现的思路之后就找到最佳的实现办法.(TDD难点:对系统的总体认识和设计)</p>
<blockquote>
<p>That is a risk you actively manage in TDD. We aren’t striving for perfection. By saying everything two ways, as both code and tests, we hope to reduce our defects enough to move forward with confidence.</p>
</blockquote>
<p>TDD开发的风险:测试和编码同时进行会引入缺陷.</p>
<blockquote>
<p>The different phases have different purposes. They call for different styles of solution, different aesthetic viewpoints.</p>
</blockquote>
<p>不同的阶段所注重的点是不同的,所以在初期设计阶段我们可以忍受重复的设计和复制粘贴代码,一切都是为了尽快完成这个阶段(clean code是重构的任务).</p>
<p>消除类冗余的过程:</p>
<ol>
<li>把子类的公共代码移到父类中.</li>
<li>对父类的其他子类进行简化.</li>
<li>合并equals()函数到父类.</li>
</ol>
<p>对equals()和hashCode()函数的覆盖和重写过程是发生在重构中的,并且已经有许多的测试来对重构做支撑.</p>
<p>在制造对象的时候使用工厂方法(factory method).</p>
<p>使用工厂模式和合理的构造器参数将重复代码移动到父类中去.</p>
<blockquote>
<p>With the tests you can decide whether an experiment would answer the question faster. Sometimes you should just ask the computer.</p>
</blockquote>
<p>在TDD中,重构时由于有足够多的测试来支撑改动所以可以使用测试来迅速验证想法而如果没有测试验证想法就只能依赖思考和论证.</p>
<p>在重构的过程中将子类代码消除后就要将其删除.</p>
<p>使用多态来消除显式的类型判定.</p>
<h1 id="Section-II-Example-xUnit"><a href="#Section-II-Example-xUnit" class="headerlink" title="Section II: Example: xUnit"></a>Section II: Example: xUnit</h1><p><strong>对TDD测试的要求:</strong></p>
<ul>
<li>Easy to write for programmers. 易于编写</li>
<li>Easy to read for programmers. 易于阅读</li>
<li>Quick to execute. 快速执行</li>
<li>Order independent. 顺序无关</li>
<li>Deterministic. 确定的:执行结果不随执行次数变化</li>
<li>Piecemeal. 零碎(足够小)</li>
<li>Composable. 可组合:可以以各种组合方式运行测试</li>
<li>Versionable. 多版本</li>
<li>A priori. 先验(在代码能运行之前就写好测试)</li>
<li>Automatic. 自动化</li>
<li>Helpful when thinking about design. 对系统的设计的思考有帮助(测试先行需要对系统有良好的组织).</li>
</ul>
<blockquote>
<p>Lots of refactoring has this feel—separating two parts so you can work on the separately. If they go back together when you are finished, fine, if not, you can leave them separate.</p>
</blockquote>
<blockquote>
<p>Here is another general pattern of refactoring—take code that works in one instance and generalize it to work in many by replacing constants with variables. </p>
</blockquote>
<p>先用常量进行测试,通过之后将常量位置改为变量就能在更多情况下使用.</p>
<p><strong>测试模式:</strong></p>
<ol>
<li>创建对象</li>
<li>激活(测试)对象</li>
<li>检查结果</li>
</ol>
<p><strong>测试的矛盾:</strong></p>
<ul>
<li>Performance 性能:测试的执行要越快越好</li>
<li>Isolation 隔离:测试之间不要互相耦合并且测试执行不依赖于其执行顺序</li>
</ul>
<h1 id="Section-III-Patterns"><a href="#Section-III-Patterns" class="headerlink" title="Section III: Patterns"></a>Section III: Patterns</h1><ul>
<li>自动化测试很重要</li>
<li>测试之间相互独立</li>
<li>开始编码之前列出测试清单</li>
<li>测试优先(测试先行)</li>
<li>使用断言</li>
<li>使用容易理解的测试数据</li>
<li>使测试数据的意图明显</li>
</ul>
<p>从测试中发现问题:</p>
<ul>
<li>冗长的设置(初始化)代码 -&gt; 对象太大</li>
<li>冗余的设置 -&gt; 对象间耦合</li>
<li>测试运行时间过长 -&gt; 测试不会被运行或运行有问题</li>
</ul>
<h1 id="Is-TDD-Dead"><a href="#Is-TDD-Dead" class="headerlink" title="Is TDD Dead?"></a>Is TDD Dead?</h1><p>在大略阅读了<a target="_blank" rel="noopener" href="https://book.douban.com/subject/25742200/">Google软件测试之道</a>和TDD之后,感觉TDD最明显的特征就是快速的实现和重构,自然这其中需要很强的”clean code”的能力,例如自然的使用工厂模式和提取参数使子类的方法向上转移到父类之上.</p>
<p>而TDD的难点也就在于在系统开发之前,如何进行合理有效的拆分,而一旦没有清晰的思路,所谓的测试先行也就变成了冥思测试用例而不得,导致开发速度变得更慢.</p>
<p>TDD的难以施行在结合Google的测试历程之后会发现,精通测试确实是”太难了”,需要开发人员在编码和测试两个方向都有较好的能力才能比较顺利的施行,而开发编写测试本身就会”遭到质疑”.哪怕强如Google也花了很长时间才让开发人员能够适应自己测试的开发节奏,可见在全新的组织中尝试实行TDD会是很痛苦的过程.</p>
<p>当然,TDD也并非是开发方法论的全部.个人感觉关键还是需要在编程时有时刻重构的思维和编写”clean code”的能力,而TDD更像是对这两种要求的结合.当你习惯了重构和能够写出”clean code”的时候,T不TDD也就变得没有那么重要了.</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://misakatang.cn/2019/09/02/InnoDB%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3-14-7-4-%E5%B9%BB%E5%BD%B1%E8%A1%8C-14-7-5-InnoDB%E7%9A%84%E6%AD%BB%E9%94%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/misaka.jpg">
      <meta itemprop="name" content="MisakaTang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MisakaTang's Blog">
      <meta itemprop="description" content="The limits of my language are the limits of my world">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | MisakaTang's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2019/09/02/InnoDB%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3-14-7-4-%E5%B9%BB%E5%BD%B1%E8%A1%8C-14-7-5-InnoDB%E7%9A%84%E6%AD%BB%E9%94%81/" class="post-title-link" itemprop="url">InnoDB官方文档--14.7.4 幻影行|14.7.5 InnoDB的死锁</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2019-09-02 14:45:22" itemprop="dateCreated datePublished" datetime="2019-09-02T14:45:22+00:00">2019-09-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-03-14 08:33:24" itemprop="dateModified" datetime="2024-03-14T08:33:24+00:00">2024-03-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/%E5%88%86%E7%B1%BB/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h4 id="14-7-4-幻影行"><a href="#14-7-4-幻影行" class="headerlink" title="14.7.4 幻影行"></a>14.7.4 幻影行</h4><p>所谓的幻读就是同一个事务在不同的时间执行相同的查询产生不同的结果行.例如,如果一个SELECT执行2次,但是第二次返回的行和第一次的不一样,这些行就被称为”幻影行”.</p>
<p>假设在child表的id列上有索引并且你想要对表中id值大于100的所有行进行加锁和读取,为了在之后更新选中列中的数据:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> child <span class="keyword">WHERE</span> id <span class="operator">&gt;</span> <span class="number">100</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure>
<p>查询从id大于100的第一个记录开始扫描.假设表包含90和102.如果扫描范围之内的索引记录没有对插入的间隙加锁,另一个会话可以插入一个id为101的新行到表中.如果你在相同的事务中执行相同的SELECT,你将会在查询结果中看到一个id为101的新行(一个”幻影”).如果我们把这一系列的行视为一个数据项的话,新的幻影数据将违反事务的隔离准则即:在事务期间读取的数据不会发生改变.</p>
<p>为了避免幻读,InnoDB使用了一个叫做next-key锁的算法,它将索引行锁定与间隙锁定相结合.InnoDB以这样的方式执行行级锁定:当它搜索或扫描表索引时,它会在遇到的索引记录上设置共享锁或独占锁.因此,行级锁其实是索引记录锁.此外,索引记录上的next-key锁也会影响索引记录前的间隙.也就是说,next-key锁是索引记录锁加上索引记录锁前间隙锁.如果一个会话在索引记录R上有一个共享或者独占锁,其他会话就不能在索引记录R之前的间隙插入一个新的索引记录了.</p>
<p>当InnoDB扫描索引时,也会对最后一个索引记录后的间隙加锁.在前面的例子中就发生了这种情况:为了避免任何比100大的id插入到表中,InnoDB设置的锁也包括了id为102之后的间隙锁.</p>
<p>你可以使用next-key锁在你的应用中实现唯一性检查:如果你在共享模式下读取你的数据并且你要插入的行中没有重复键,那你就可以安全的插入行数据并且知道在你读取期间设置的next-key锁会组织任何人在同时插入和你重复键的行数据.因此,next-key锁能够使你锁定某些表中不存在的数据.</p>
<h4 id="14-7-5-InnoDB的死锁"><a href="#14-7-5-InnoDB的死锁" class="headerlink" title="14.7.5 InnoDB的死锁"></a>14.7.5 InnoDB的死锁</h4><p>死锁是不同的事务因为互相持有其他事务需要的锁而不能继续处理的情况.因为每个事务都会等待需要的资源释放同时也不会释放已经获取的资源.</p>
<p>当事务锁定多个表中的行时(通过例如UPDATE或SELECT…FOR UPDATE语句),可能会发生死锁,但是顺序相反.当这类语句锁定索引记录和间隙时也会发生死锁,由于时间问题每个事务都获得了一些锁而没有其他的锁.</p>
<p>为了减少死锁发生的可能性,最好使用事务而不是LOCK TABLES语句;保持插入或更新数据的事务足够小,使其不会长时间保持连接状态;当不同的事务更新多个表或大量行的时候,对每个事务使用相同的操作顺序(例如SELECT…FOR UPDATE);对SELECT…FOR UPDATE和UPDATE…WHERE语句用到的行创建索引.产生死锁的概率不会受事务隔离级别的影响,因为隔离级别改变的是读取操作的行为,而死锁的发生是因为读操作.</p>
<p>当死锁检测启用(默认启用)并且确实发生死锁的时候,InnoDB会检测到这种情况并且回滚其中的一个事务.如果死锁检测使用<code> innodb_deadlock_detect</code>配置选项禁用,InnoDB根据<code> innodb_lock_wait_timeout</code>设置在死锁时回滚事务.因此,即使你的应用逻辑正确,你也必须处理事务要重试的情况.查看InnoDB用户事务的最后一个死锁,使用<code> SHOW ENGINE INNODB STATUS</code>命令.如果在事务结构或应用程序错误处理中频繁发生死锁,使用<code> innodb_print_all_deadlocks</code>参数运行MySQL来启用关于MySQL错误日志中所有和死锁相关的信息的打印.</p>
<h5 id="14-7-5-1-一个InnoDB死锁的例子"><a href="#14-7-5-1-一个InnoDB死锁的例子" class="headerlink" title="14.7.5.1 一个InnoDB死锁的例子"></a>14.7.5.1 一个InnoDB死锁的例子</h5><p>下面的例子演示了当进行加锁请求的时候一个错误是如何造成死锁的.例子包括2个客户端,A和B.</p>
<p>首先,客户端A创建一个表包含一行数据然后开启一个事务.在事务中,A使用select的共享模式(share mode)对行数据加了S锁:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t (i <span class="type">INT</span>) ENGINE <span class="operator">=</span> InnoDB;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">1.07</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">INSERT</span> <span class="keyword">INTO</span> t (i) <span class="keyword">VALUES</span>(<span class="number">1</span>);</span><br><span class="line">Query OK, <span class="number">1</span> <span class="type">row</span> affected (<span class="number">0.09</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">START</span> TRANSACTION;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> t <span class="keyword">WHERE</span> i <span class="operator">=</span> <span class="number">1</span> LOCK <span class="keyword">IN</span> SHARE MODE;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span> i    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br><span class="line"><span class="operator">|</span>    <span class="number">1</span> <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+</span></span><br></pre></td></tr></table></figure>

<p>接下来,客户端B开始一个事务并且从表中删除该行:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">START</span> TRANSACTION;</span><br><span class="line">Query OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">DELETE</span> <span class="keyword">FROM</span> t <span class="keyword">WHERE</span> i <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>删除操作需要一个X锁.这个锁不能被授予因为其和客户端A所持有的S锁不相容,所以这个请求进入了加锁请求队列并且客户端B阻塞了.</p>
<p>最后,客户端A也尝试从表中删除该行:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">DELETE</span> <span class="keyword">FROM</span> t <span class="keyword">WHERE</span> i <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">ERROR <span class="number">1213</span> (<span class="number">40001</span>): Deadlock found <span class="keyword">when</span> trying <span class="keyword">to</span> <span class="keyword">get</span> lock;</span><br><span class="line">try restarting transaction</span><br></pre></td></tr></table></figure>

<p>在这里死锁发生了因为客户端A需要一个X锁来删除该行.然而这个加锁请求不能被授予因为客户端B已经请求了一个X锁并且在等待客户端A释放S锁.由于B对X锁的请求比A更早,持有S锁的A也不能获取到X锁.结果是InnoDB为其中一个客户端产生了一个错误并且释放它的锁.这个客户端会返回下面的错误:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1213 (40001): Deadlock found when trying to get lock;</span><br><span class="line">try restarting transaction</span><br></pre></td></tr></table></figure>
<p>在这个时候,另一个客户端的加锁请求就可以被授予并且从表中删除行了.</p>
<h5 id="14-7-5-2-死锁的发现和回滚"><a href="#14-7-5-2-死锁的发现和回滚" class="headerlink" title="14.7.5.2 死锁的发现和回滚"></a>14.7.5.2 死锁的发现和回滚</h5><p>当死锁检测启用的时候(默认),InnoDB会自动检测事务的死锁并且回滚一个或者多个事务来打破死锁.InnoDB会尝试选择一个小的事务来进行回滚,事务的大小由插入,更新或删除的行的数量来决定.</p>
<p>InnoDB在innodb_table_locks &#x3D; 1(默认值)和 autocommit &#x3D; 0的时候知道表锁的存在,并且MySQL层面知道行级锁.换句话说,InnoDB在表被MySQL的LOCK TABLE加锁或者InnoDB以外的引擎设置锁的时候是不能检测死锁的.通过设置<code>innodb_lock_wait_timeout</code>系统变量来改善这种情况.</p>
<p>当InnoDB执行一个完整的事务回滚的时候,这个事务设置的所有锁都会被释放.然而,如果由于错误而回滚单个的SQL语句,则该语句设置的锁有可能会被保留.发生这种情况是因为InnoDB用这样一种格式来存储行级锁:它无法知道哪些锁是被哪些语句设置的.</p>
<p>如果SELECT语句在事务中调用存储的函数,并且函数中的语句失败了,这个语句会回滚.此外,如果在这之后执行了ROLLBACK那么整个事务会被回滚.</p>
<p>如果InnoDB监控器输出的 LATEST DETECTED DEADLOCK部分包括这样的信息 “TOO DEEP OR LONG SEARCH IN THE LOCK TABLE WAITS-FOR GRAPH, WE WILL ROLL BACK FOLLOWING TRANSACTION,”这表示等待列表中的事务已经达到了200.超过200个事务的等待列表会被视为死锁并且等待列表中的事务会尝试回滚.如果加锁线程必须查看等待列表中有超过1,000,000个锁的事务时也会产生相同的错误.</p>
<p><strong>禁用死锁检测</strong></p>
<p>在高并发系统上,当许多线程等待同一个锁时,死锁检测会导致速度减慢.有时,在发生死锁时,禁用死锁检测并依赖innodb_lock_wait_timeout设置进行事务回滚可能更有效.可以使用innodb_deadlock_detect配置选项禁用死锁检测.</p>
<h5 id="14-7-5-3-如何最小化和处理死锁"><a href="#14-7-5-3-如何最小化和处理死锁" class="headerlink" title="14.7.5.3 如何最小化和处理死锁"></a>14.7.5.3 如何最小化和处理死锁</h5><p>这一节的内容以上一节死锁的知识为基础.介绍了如何组织数据库操作来最小化死锁和应用程序中所需要的错误处理.</p>
<p>死锁在支持事务的数据库中是一个经典问题,但是其不危险除非其频繁到你无法执行某些事务.通常你必须在应用程序中准备处理死锁回滚而重新提交事务.</p>
<p>InnoDB使用自动行级锁.即使是插入或者删除单行的事务也可能会遇到死锁.这是因为这些操作通常不够”原子”;它们会自动对被插入或删除的行的索引记录设置锁.</p>
<p>你可以使用以下技术处理死锁并降低其发生的可能性:</p>
<ul>
<li><p>在任何时候,使用<code> SHOW ENGINE INNODB STATUS</code>命令来确定最近的死锁发生的原因.这可以帮助你调整应用程序以避免死锁.</p>
</li>
<li><p>如果频繁的死锁警告引起了关注,通过启用<code>innodb_print_all_deadlocks</code>配置选项来收集更多的调试信息.每个死锁(不只是最后一个)的信息都记录在MySQL的错误日志里.在你完成debug之后禁用这个选项.</p>
</li>
<li><p>如果因为死锁(而导致回滚),总是准备好重新提交事务.死锁不危险.只是重新提交一遍而已.</p>
</li>
<li><p>保持事务短小并且执行时间短使其不易发生冲突.</p>
</li>
<li><p>在进行一组相关更改后立即提交事务,以使它们不易发生冲突.特别是,不要使用未提交的事务使交互式mysql会话长时间保持打开状态.</p>
</li>
<li><p>如果你使用加锁读(<code>SELECT...FOR UPDATE</code>或<code>SELECT... LOCK IN</code>),尝试使用更低的事务隔离级别例如<code>READ COMMITED</code>.</p>
</li>
<li><p>当在一个事务中修改多个表或者相同表中不同的行的时候,每次都用相同的顺序执行.事务就会形成良好的队列而不会死锁.例如,将数据库操作组织到应用程序中的函数中,或调用存储的函数,而不是在不同的位置编写多个类似的INSERT,UPDATE和DELETE语句.</p>
</li>
<li><p>在你的表中添加仔细选择的索引.然后,你的查询需要扫描更少的索引记录,从而设置更少的锁.使用<code>EXPLAIN SELECT</code>确定MySQL服务器认为哪些索引最适合您的查询.</p>
</li>
<li><p>使用更少的锁.如果你允许SELECT从旧快照返回数据,就不要在其中添加FOR UPDATE或LOCK IN SHARE MODE子句.在这里可以使用<code>READ COMMITTED</code>隔离级别,因为同一事务中的每个一致读取都从其自己的新快照读取.</p>
</li>
<li><p>如果没有其他帮助,请使用表级锁定序列化你的事务.将<code>LOCK TABLES</code>与事务表(如InnoDB表)一起使用的正确方法是使用<code>SET autocommit = 0</code>(不是<code>START TRANSACTION</code>)开始事务,然后<code>LOCK TABLES</code>,并且在您明确提交事务之前不要调用<code>UNLOCK TABLES</code>.</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> autocommit<span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">LOCK TABLES t1 WRITE, t2 READ, ...;</span><br><span class="line">... do something <span class="keyword">with</span> tables t1 <span class="keyword">and</span> t2 here ...</span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br><span class="line">UNLOCK TABLES;</span><br></pre></td></tr></table></figure>

<p>  表级锁可防止对表的并发更新,从而避免死锁,但代价是对繁忙系统的响应性较低.</p>
</li>
<li><p>序列化事务的另一种方法是创建一个只包含一行的辅助“信号量”表.让每个事务在访问其他表之前更新该行.这样,所有事务都以串行方式发生.请注意,InnoDB即时死锁检测算法在这种情况下也适用,因为序列化锁是一个行级锁.使用MySQL表级锁定时,必须使用超时方法来解决死锁.</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/12/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/page/14/">14</a><span class="space">&hellip;</span><a class="page-number" href="/page/34/">34</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/14/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="user"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">MisakaTang</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/TangMisaka23001" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  <script src="/js/third-party/pace.js"></script>


  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","mhchem":false,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
